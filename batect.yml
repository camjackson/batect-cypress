project_name: batect-cypress

containers:
  app:
    build_directory: .
    volumes:
      - local: .
        container: /app
        options: cached
    working_directory: /app
    build_args:
      PORT: 8352
    environment:
      PORT: 8352

  cypress:
    image: cypress/included:3.4.1
    volumes:
      - local: .
        container: /app
        options: cached
    working_directory: /app

tasks:
  setup:
    run:
      container: app
      command: npm install

  app:
    run:
      container: app

  e2e:
    run:
      container: cypress
      command: cypress run --config baseUrl=http://app:8352
    dependencies:
      - app
